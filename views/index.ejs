<link rel="stylesheet" href="../public/css/index.css">

<header>
    <div class="container">
      <h1>Sayuran Segar Setiap Hari, Tanpa Ribet!</h1>
      <p>Ingin hidup lebih sehat tanpa repot? Kami hadir untuk memenuhi kebutuhan sayuran segar Anda.</p>
    </div>
</header>

<div class="separator"></div>

<div class="container">
    <h1>Tentang Kami</h1>
    <p>Sejarah UMKM</p>
    <div class="content">
        <div class="image-container">
            <img src="/public/img/sayur1.jpg" alt="Sayuran" class="sayuran-image">
        </div>
        <div class="text-container">
            <p><strong>UD. CAHAYA SAYUR</strong> adalah UMKM yang bergerak di bidang perdagangan. Berdiri pada tahun 2000, UMKM ini beralamat di Pasar Wangon, Kecamatan Wangon, Kabupaten Banyumas, Jawa Tengah, Indonesia.</p>
            <p>UD. CAHAYA SAYUR didirikan dengan tujuan untuk memenuhi kebutuhan pasar akan sayuran segar dengan kualitas terbaik. Kami selalu berusaha untuk menjadi seproduktif dan seefisien mungkin dalam beroperasi, dengan meminimalkan dampak negatif terhadap lingkungan dan masyarakat sekitar.</p>
            <p>Visi kami adalah untuk memberikan solusi terbaik bagi pelanggan dengan menyediakan produk berkualitas tinggi dengan harga yang kompetitif. Melalui usaha yang tekun dan inovatif, UD. CAHAYA SAYUR telah menjadi pilihan utama bagi banyak konsumen dalam memenuhi kebutuhan sayuran segar di daerah ini.</p>
        </div>
    </div>
</div>

<!-- <div class="container mt-5">
    <h1 class="text-center">Product Kami</h1>

    <form id="addProductForm" class="my-4">
        <div class="input-group">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">Add Product</button>
        </div>
    </form>
    <div id="productList" class="row row-cols-1 row-cols-md-3 g-4">
    </div>
    <div id="addProductModal" class="modal fade" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addProductFormModal">
                        <div class="form-group">
                            <label for="newProductName">Product Name</label>
                            <input type="text" id="newProductName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newProductDescription">Description</label>
                            <input type="text" id="newProductDescription" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newProductPrice">Price</label>
                            <input type="text" id="newProductPrice" class="form-control" required>
                        </div>
                        <div id="fileInputContainer" style="display:none;">
                            <label for="newProductImage">Image</label>
                            <input type="file" id="newProductImage" name="image" class="form-control" accept="image/*" />
                        </div>
                        <button type="submit" class="btn btn-primary mt-3">Add Product</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal fade" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm">
                        <div class="form-group">
                            <label for="editProductName">Product Name</label>
                            <input type="text" id="editProductName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductDescription">Description</label>
                            <input type="text" id="editProductDescription" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductPrice">Price</label>
                            <input type="text" id="editProductPrice" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="editProductImage">Image</label>
                            <input type="file" id="editProductImage" name="image" class="form-control" accept="image/*" />
                            <img id="currentProductImage" src="" alt="Current Product Image" width="100" height="100" class="mt-2" />
                        </div>                        
                        <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div> -->


<section id="contact" class="contact">
    <h2><span>Kontak</span> Kami</h2>
    <p>Hubungi kami jika anda butuh sayuran
    </p>

    <div class="row">
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3955.42484039075!2d109.06897217326524!3d-7.52855459248451!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e656fe938c27b1b%3A0xb369fc2f007b604!2sCahaya%20Sayur%20AR!5e0!3m2!1sen!2sid!4v1731335175613!5m2!1sen!2sid" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

      <form id="contactForm">
        <div class="input-group">
          <i data-feather="user"></i>
          <input type="text" id="contactName" placeholder="Nama" required>
        </div>
        <div class="input-group">
          <i data-feather="map-pin"></i>
          <input type="text" id="contactAddress" placeholder="Alamat" required>
        </div>
        <div class="input-group">
          <i data-feather="phone"></i>
          <input type="tel" id="contactPhone" placeholder="No HP" required>
        </div>
        <div class="input-group">
          <textarea id="contactMessage" placeholder="Pesan Anda..." required></textarea>
        </div>
        <button type="submit" class="btn">Kirim Pesan</button>
      </form>

    </div>

    <div class="mt-4">
        <a href="/report" class="btn btn-primary">Lihat Laporan</a>
    </div>

  </section>

<footer class="footer">
    <div class="container text-center">
        <p>&copy; 2024 Product App. All Rights Reserved.</p>
        <h4>Anggota Kelompok 2:</h4>
      <p>Muhammad Akbar Kurniawan (20220140155)</p>
      <p>Muhammad Hilal Fakhri (20220140151)</p>
      <p>Muhammad Arif Fajri (20220140171)</p>
      <p>Muhammad Agus Kurniawan (20220140202)</p>
      <p>Deni Arif Wibowo (20220140188)</p>
      <p>Alfandi Alamshach (20220140152)</p>
      <p>Adam Hanafi Putra (20220140129)</p>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let produk = [];
    const productListContainer = document.getElementById('productList');
    const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
    const fileInputContainer = document.getElementById('fileInputContainer');
    const addProductFormModal = document.getElementById('addProductFormModal');
    const editModal = new bootstrap.Modal(document.getElementById('editModal'));
    const editProductForm = document.getElementById('editProductForm');
    const editProductNameInput = document.getElementById('editProductName');
    const editProductDescriptionInput = document.getElementById('editProductDescription');
    const editProductPriceInput = document.getElementById('editProductPrice');
    let currentEditId = null;

    // Fungsi untuk menampilkan produk
    function renderproduk() {
        // Menghapus semua produk yang lama di DOM
        productListContainer.innerHTML = '';

        // Loop untuk menampilkan produk satu per satu
        produk.forEach(product => {
            const productCard = document.createElement('div');
            productCard.classList.add('col', 'product-card');
            productCard.setAttribute('data-id', product.id_produk);
            productCard.innerHTML = `
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">${product.nama_produk}</h5>
                        <p class="card-text">${product.deskripsi}</p>
                        <p class="card-price">${product.harga}</p>
                        ${product.image_url ? `<img src="${product.image_url}" alt="Product Image" width="50" height="50" class="ml-2" />` : ''}
                        <button class="btn btn-sm btn-success editBtn" data-id="${product.id_produk}">Edit</button>
                        <button class="btn btn-sm btn-danger deleteBtn" data-id="${product.id_produk}">Delete</button>
                    </div>
                </div>
            `;
            productListContainer.appendChild(productCard);
        });

        // Pasang event listener untuk tombol Edit dan Delete
        document.querySelectorAll('.editBtn').forEach(btn => {
            btn.addEventListener('click', function () {
                currentEditId = btn.getAttribute('data-id');
                const product = produk.find(p => p.id_produk == currentEditId);

                // Isi form edit dengan data produk yang dipilih
                editProductNameInput.value = product.nama_produk;
                editProductDescriptionInput.value = product.deskripsi;
                editProductPriceInput.value = product.harga;

                // Menampilkan gambar jika ada
                const currentImage = document.getElementById('currentProductImage');
                if (product.image_url) {
                    currentImage.src = product.image_url;
                    currentImage.style.display = 'block';
                } else {
                    currentImage.style.display = 'none';
                }

                $('#editProductImage').val('');
                editModal.show();
            });
        });

        document.querySelectorAll('.deleteBtn').forEach(btn => {
            btn.addEventListener('click', function () {
                const id = btn.getAttribute('data-id');
                $.ajax({
                    url: '/produk/' + id,
                    type: 'DELETE',
                    success: function () {
                        produk = produk.filter(product => product.id_produk != id);
                        renderproduk(); // Refresh list produk setelah dihapus
                    }
                });
            });
        });

        // Set scroll ke bagian bawah ketika produk baru ditambahkan
        const container = document.getElementById('productList');
        container.scrollTop = container.scrollHeight;
    }

   // Form untuk menambah produk
$('#addProductFormModal').on('submit', function (e) {
    e.preventDefault();
    const newProductName = $('#newProductName').val().trim();
    const newProductDescription = $('#newProductDescription').val().trim();
    const newProductPrice = $('#newProductPrice').val().trim();
    if (!newProductName || !newProductDescription || !newProductPrice) return;

    const image = $('#newProductImage')[0].files[0];
    const formData = new FormData();
    formData.append('nama_produk', newProductName);
    formData.append('deskripsi', newProductDescription);
    formData.append('harga', newProductPrice);
    if (image) formData.append('image', image);

    $.ajax({
        url: '/produk',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function (newProduct) {
            // Menambahkan produk baru ke array produk
            produk.push(newProduct);
            
            // Menambahkan elemen baru ke dalam DOM tanpa merender ulang semua produk
            const productCard = document.createElement('div');
            productCard.classList.add('col', 'product-card');
            productCard.setAttribute('data-id', newProduct.id_produk);
            productCard.innerHTML = `
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">${newProduct.nama_produk}</h5>
                        <p class="card-text">${newProduct.deskripsi}</p>
                        <p class="card-price">${newProduct.harga}</p>
                        ${newProduct.image_url ? `<img src="${newProduct.image_url}" alt="Product Image" width="50" height="50" class="ml-2" />` : ''}
                        <button class="btn btn-sm btn-success editBtn" data-id="${newProduct.id_produk}">Edit</button>
                        <button class="btn btn-sm btn-danger deleteBtn" data-id="${newProduct.id_produk}">Delete</button>
                    </div>
                </div>
            `;
            productListContainer.appendChild(productCard);

            // Reset form dan tutup modal
            $('#addProductModal').modal('hide');
            $('.modal-backdrop').remove();
            $('#addProductFormModal')[0].reset();
            fileInputContainer.style.display = 'none';
            renderproduk();
            addProductModal.hide();
            $('.modal-backdrop').remove();
        },
        error: function (error) {
            console.error("Error adding product:", error.responseText);
        }
    });
});

    // Form untuk mengedit produk
    $('#editProductForm').on('submit', function (e) {
        e.preventDefault();

        const updatedProductName = $('#editProductName').val().trim();
        const updatedProductDescription = $('#editProductDescription').val().trim();
        const updatedProductPrice = $('#editProductPrice').val().trim();
        const newImage = $('#editProductImage')[0].files[0];

        if (!updatedProductName || !updatedProductDescription || !updatedProductPrice) return;

        const formData = new FormData();
        formData.append('nama_produk', updatedProductName);
        formData.append('deskripsi', updatedProductDescription);
        formData.append('harga', updatedProductPrice);
        if (newImage) formData.append('image', newImage);

        $.ajax({
            url: '/produk/' + currentEditId,
            type: 'PUT',
            data: formData,
            processData: false,
            contentType: false,
            success: function (updatedProduct) {
                // Memperbarui data produk dalam array
                const product = produk.find(p => p.id_produk == currentEditId);
                product.nama_produk = updatedProduct.nama_produk;
                product.deskripsi = updatedProduct.deskripsi;
                product.harga = updatedProduct.harga;
                if (updatedProduct.image_url) {
                    product.image_url = updatedProduct.image_url;
                }

                renderproduk(); // Perbarui produk yang diedit
                editModal.hide();
                $('.modal-backdrop').remove();
            },
            error: function (error) {
                console.error("Error updating product:", error.responseText);
            }
        });
    });

    $(document).ready(function () {
        $.get('/produk', function (data) {
            produk = data;
            renderproduk(); // Render produk saat pertama kali dimuat
        });
    });

    // Tampilkan file input saat modal Add Product dibuka
    $('#addProductModal').on('shown.bs.modal', function () {
        fileInputContainer.style.display = 'block';
        $('#newProductName').val('');
        $('#newProductDescription').val('');
        $('#newProductPrice').val('');
        $('#newProductImage').val('');
    });

    // Sembunyikan file input dan reset form saat modal Add Product ditutup
    $('#addProductModal').on('hidden.bs.modal', function () {
        $('.modal-backdrop').remove();
        $('#newProductName').val('');
        $('#newProductDescription').val('');
        $('#newProductPrice').val('');
        $('#newProductImage').val('');
    });

    //Contact
    document.getElementById('contactForm').addEventListener('submit', function (e) {
        e.preventDefault();
    
        const name = document.getElementById('contactName').value;
        const address = document.getElementById('contactAddress').value;
        const phone = document.getElementById('contactPhone').value;
        const message = document.getElementById('contactMessage').value;
    
        // Format pesan untuk WhatsApp
        const whatsappMessage = `Halo, saya ${name} dari ${address}. No HP: ${phone}. Pesan: ${message}`;
        const whatsappURL = `https://wa.me/6282269790590?text=${encodeURIComponent(whatsappMessage)}`;
    
        // Kirim data ke backend untuk menyimpan ke database
        fetch('/api/contact', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, address, phone, message }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                // Redirect ke WhatsApp
                window.open(whatsappURL, '_blank');
                alert('Pesan berhasil dikirim!');
                document.getElementById('contactForm').reset();
            } else {
                alert('Gagal mengirim pesan, silakan coba lagi.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Terjadi kesalahan. Silakan coba lagi.');
        });
    });
    
      
</script>
